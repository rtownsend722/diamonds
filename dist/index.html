<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://d3js.org/d3-force.v1.min.js"></script>
    <script src="/lesmis.json"></script>
    <title>Les Miserables</title>
    <style>

    </style>
  </head>
  <body>
    <div>HELLO WORLD</div>
    <script>


    const height = 960;
    const width = 1060;

    const nodes = window.data.nodes;
    const links = window.data.links;
    links.forEach(link => {
      nodes.forEach(node => {
        if (node.id === link.source) {
          link.source = nodes.indexOf(node);
        }
      });
      nodes.forEach(node => {
        if (node.id === link.target) {
          link.target = nodes.indexOf(node);
        }
      });
    });
    console.log(nodes);
    console.log(links);

    var svg = d3.select('body').append('svg')
      .attr('width', width)
      .attr('height', height);

    var force = d3.layout.force()
      .size([width, height])
        .nodes(d3.values(nodes))
        .links(links);

    force.start();

    var node = svg.selectAll('circle')
      .data(nodes)
      .enter().append('circle')
      .attr('r', 5);

    var link = svg.selectAll('line')
      .data(links)
      .enter().append('line');


    force.on('tick', () => {
      node.attr('cx', d => d.x)
      .attr('cy', d => d.y);

      link.attr('x1', d => d.source.x)
        .attr('y1', d => d.source.y)
        .attr('x2', d => d.target.x)
        .attr('y2', d => d.target.y); 

    });

    </script>
  </body>
</html>